<q-page padding class="flex flex-center q-pt-xl">
  <div class="full-width" v-if="matchs">
    <div class="q-gutter-y-md" style="padding-top: 72px;">

      <q-card bordered>
        <q-tab-panels
          v-model="matchTab"
          ref="matchTabs"
          keep-alive
          animated>
          <q-tab-panel
            :name="matchIndex"
            v-for="(matchItem, matchIndex) in matchs" :key="'tab-panel' + matchIndex">
            <div class="row q-col-gutter-md">
              <div
                class="col-3 col-lg-3 col-sm-6"
                v-for="(matchTeamItem, teamIndex) in matchs[matchIndex].matchTeams"
                :key="matchTeamItem.team.id">
                <MatchTeamListCard
                  :match="matchTeamItem"
                  :color="matchTeamItem.color"
                  :star="isInBestMatchTeam(matchTeamItem.id)"
                  :lastScored="lastScored === matchTeamItem.id"
                  @updateScore="updateScore" />
              </div>
            </div>
          </q-tab-panel>
        </q-tab-panels>

        <q-card-section>
          <q-toolbar class="q-pt-lg">
            <div class="row full-width">
              <div class="col-4 text-left">
                <q-btn
                  flat
                  round
                  color="indigo"
                  icon="fas fa-backward"
                  size="xl"
                  class="q-mr-sm"
                  :disable="!currentMatch.is_closed || matchTab === 0"
                  @click="$refs.matchTabs.previous()" />
              </div>
              <div class="col-4 text-center">
                <q-btn
                  flat
                  round
                  :color="currentMatch.is_closed ? 'positive' : 'negative'"
                  icon="fas fa-power-off"
                  size="xl"
                  class="q-mx-sm"
                  @click="closeMatchPopup = !closeMatchPopup ? true : false" />
              </div>
              <div class="col-4 text-right">
                <q-btn
                  flat
                  round
                  color="indigo"
                  icon="fas fa-forward"
                  size="xl"
                  class="q-ml-sm"
                  :disable="!currentMatch.is_closed || matchTab === (matchs.length - 1)"
                  @click="$refs.matchTabs.next()" />
              </div>
            </div>
          </q-toolbar>
        </q-card-section>
        <q-separator />
        <q-card-section class="bg-grey-3">
          <p class="text-center q-pt-md">
            {{ allScoresCount }} chansons jouées dans ce match
          </p>
        </q-card-section>
      </q-card>

    </div>
  </div>

  <q-dialog
    ref="dialog-success"
    maximized
    auto-close
    v-model="teamSuccessPopup"
    transition-show="fade"
    transition-hide="fade">
    <q-card dark style="overflow: hidden;">
      <q-card-section class="text-h3 text-center q-py-xl">
        <q-icon name="fas fa-star q-mr-lg" style="margin-bottom:22px;" />
        Point pour
        <span :class="'text-uppercase text-' + successTeamColor">
          {{ successTeamName }}
        </span>
        <q-icon name="fas fa-star q-ml-lg" style="margin-bottom:22px;" />
      </q-card-section>
      <q-card-section class="flex flex-center">
        <img
          contain
          :src="successImage"
          class="rounded-borders"
          style="height: 80vh;" />
      </q-card-section>
    </q-card>
  </q-dialog>

  <q-dialog
    ref="dialog-close-match"
    persistent
    v-model="closeMatchPopup"
    transition-show="slide-down"
    transition-hide="fade">
    <q-card style="width: 900px;">
      <q-card-section class="text-h6 bg-indigo text-white">
        Résultats du Match
      </q-card-section>
      <q-card-section>
        <div class="q-pa-md">
          <q-list separator>
            <q-item
              v-for="(matchTeam, index) in matchTeamsRanking"
              :key="matchTeam.id">
             <q-item-section>
                <q-avatar rounded>
                  <q-img cover :src="`statics/avatars/${matchTeam.team.avatar}`" />
                </q-avatar>
              </q-item-section>
              <q-item-section>
                <q-linear-progress
                  stripe
                  rounded
                  style="height: 40px"
                  :value="(matchTeam.score / allScoresCount)"
                  color="positive"
                  class="q-mt-sm">
                  <div class="absolute-full flex flex-center">

                  </div>
                </q-linear-progress>
              </q-item-section>
              <q-item-section >
                <q-badge
                    class="text-bold text-body2 "
                    align="middle"
                    :color="matchTeam.color"
                    text-color="white"
                    :label="matchTeam.score + ' Point' + (matchTeam.score > 1 ? 's' : '' )" />
              </q-item-section>

              <q-item-section :class="'text-h6 text-' + matchTeam.color">
                {{ matchTeam.team.name }}
              </q-item-section>
            </q-item>
          </q-list>
        </div>
      </q-card-section>
      <q-separator />
      <q-card-actions align="between">
        <q-btn
          flat
          v-ripple
          color="grey"
          icon="fas fa-times"
          label="Annuler"
          size="lg"
          v-close-popup />
        <q-btn
          flat
          v-ripple
          icon-right="fas fa-arrow-right"
          label="Match suivant"
          color="indigo"
          size="lg"
          @click="nextMatch()"
          v-close-popup />
      </q-card-actions>
    </q-card>
  </q-dialog>

</q-page>
